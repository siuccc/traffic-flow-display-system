{% extends "base.html" %}

{% block title %}首页 - 交通流量数据展示系统{% endblock %}

{% block content %}
<!-- 页面主要内容 -->
<div class="content-wrapper">
    <!-- 数据统计信息 -->
    <div class="info-section">
        <h2>📊 交通数据概览</h2>
    </div>

    <!-- 搜索功能区域 -->
    <div class="search-section">
        <h3>搜索</h3>
        <form method="GET" class="search-form">
            <div class="search-controls">
                <!-- 时间段选择器 -->
                <div class="input-group">
                    <select name="time_range" 
                            id="timeRangeSelect" 
                            class="search-input">
                        <option value="">全部时间</option>
                        <option value="morning">早高峰 (07:00-09:00)</option>
                        <option value="noon">中午时段 (11:00-13:00)</option>
                        <option value="afternoon">下午时段 (14:00-17:00)</option>
                        <option value="evening">晚高峰 (17:00-19:00)</option>
                        <option value="night">夜间时段 (20:00-06:00)</option>
                    </select>
                    <label for="timeRangeSelect" class="input-label">时间段</label>
                </div>
                
                <!-- 方向选择框 -->
                <div class="input-group">
                    <select name="direction" 
                            id="directionSelect" 
                            class="search-input">
                        <option value="">全部方向</option>
                        <option value="1">北往南</option>
                        <option value="2">南往北</option>
                        <option value="3">东往西</option>
                        <option value="4">西往东</option>
                    </select>
                    <label for="directionSelect" class="input-label">行驶方向</label>
                </div>
                
                <!-- 搜索按钮组 -->
                <div class="button-group">
                    <button type="submit" class="search-btn">
                        🔍 搜索
                    </button>
                    <a href="/" class="clear-btn">
                        🗑️ 清空
                    </a>
                </div>
            </div>
        </form>
        
        <!-- 搜索状态显示 -->
        <div class="search-status">
            <span class="status-text" id="search-status-text">
                📋 正在加载数据...
            </span>
        </div>
    </div>

    <!-- 数据可视化区域 -->
    <div class="chart-section">
        <h3>📊 数据可视化</h3>
        
        <!-- 方向分布饼图 -->
        <div class="chart-item">
            <h4>🍰 方向分布统计</h4>
            <div class="chart-container" id="pie-chart-container">
                <div class="loading">📊 加载中...</div>
            </div>
        </div>
        
        <!-- 24小时趋势图 -->
        <div class="chart-item">
            <h4>📈 24小时车流量趋势</h4>
            <div class="chart-container chart-wide" id="trend-chart">
                <div class="loading">📈 加载中...</div>
            </div>
        </div>
        
        <!-- 工作日vs周末对比图 -->
        <div class="chart-item">
            <h4>📊 工作日vs周末流量对比</h4>
            <div class="chart-container chart-wide" id="weekday-weekend-chart">
                <div class="loading">📈 加载中...</div>
            </div>
        </div>
    </div>

    <!-- 交通数据表格 -->
    <div class="table-section">
        <h3>🚗 交通记录列表</h3>
        
        <!-- 统一的表格结构 (AJAX动态更新) -->
        <table class="traffic-table" id="traffic-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>方向</th>
                    <th>通过时间</th>
                    <th>车牌号</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td colspan="4" style="text-align: center; padding: 40px;">
                        <div style="color: #666;">⏳ 正在加载数据...</div>
                    </td>
                </tr>
            </tbody>
        </table>
        
        <!-- 分页导航 (AJAX动态更新) -->
        <div class="pagination" id="pagination-container">
            <!-- 上一页按钮 -->
            <button class="page-btn prev-btn disabled">
                ⬅️ 上一页
            </button>
            
            <!-- 页码显示 -->
            <div class="page-numbers">
                <span class="page-num current">1</span>
            </div>
            
            <!-- 页码跳转输入框 -->
            <div class="page-jump">
                <span class="jump-label">跳转到</span>
                <input type="number" id="pageInput" class="page-input" min="1" max="1" placeholder="1">
                <button onclick="jumpToPage()" class="jump-btn">GO</button>
            </div>
            
            <!-- 下一页按钮 -->
            <button class="page-btn next-btn disabled">
                下一页 ➡️
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/pagination.js') }}"></script>
<script src="{{ url_for('static', filename='js/ajax-search.js') }}"></script>
{% endblock %}
