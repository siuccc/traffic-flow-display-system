{% extends "base.html" %}

{% block title %}é¦–é¡µ - äº¤é€šæµé‡æ•°æ®å±•ç¤ºç³»ç»Ÿ{% endblock %}

{% block content %}
<!-- é¡µé¢ä¸»è¦å†…å®¹ -->
<div class="content-wrapper">
    <!-- æ•°æ®ç»Ÿè®¡ä¿¡æ¯ -->
    <div class="info-section">
        <h2>ğŸ“Š äº¤é€šæ•°æ®æ¦‚è§ˆ</h2>
    </div>

    <!-- æœç´¢åŠŸèƒ½åŒºåŸŸ -->
    <div class="search-section">
        <h3>æœç´¢</h3>
        <form method="GET" class="search-form">
            <div class="search-controls">
                <!-- æ—¶é—´æ®µé€‰æ‹©å™¨ -->
                <div class="input-group">
                    <select name="time_range" 
                            id="timeRangeSelect" 
                            class="search-input">
                        <option value="" {% if not time_search %}selected{% endif %}>å…¨éƒ¨æ—¶é—´</option>
                        <option value="morning" {% if time_search == 'morning' %}selected{% endif %}>æ—©é«˜å³° (07:00-09:00)</option>
                        <option value="noon" {% if time_search == 'noon' %}selected{% endif %}>ä¸­åˆæ—¶æ®µ (11:00-13:00)</option>
                        <option value="afternoon" {% if time_search == 'afternoon' %}selected{% endif %}>ä¸‹åˆæ—¶æ®µ (14:00-17:00)</option>
                        <option value="evening" {% if time_search == 'evening' %}selected{% endif %}>æ™šé«˜å³° (17:00-19:00)</option>
                        <option value="night" {% if time_search == 'night' %}selected{% endif %}>å¤œé—´æ—¶æ®µ (20:00-06:00)</option>
                    </select>
                    <label for="timeRangeSelect" class="input-label">æ—¶é—´æ®µ</label>
                </div>
                
                <!-- æ–¹å‘é€‰æ‹©æ¡† -->
                <div class="input-group">
                    <select name="direction" 
                            id="directionSelect" 
                            class="search-input">
                        <option value="" {% if not direction_search %}selected{% endif %}>å…¨éƒ¨æ–¹å‘</option>
                        <option value="1" {% if direction_search == '1' %}selected{% endif %}>åŒ—å¾€å—</option>
                        <option value="2" {% if direction_search == '2' %}selected{% endif %}>å—å¾€åŒ—</option>
                        <option value="3" {% if direction_search == '3' %}selected{% endif %}>ä¸œå¾€è¥¿</option>
                        <option value="4" {% if direction_search == '4' %}selected{% endif %}>è¥¿å¾€ä¸œ</option>
                    </select>
                    <label for="directionSelect" class="input-label">è¡Œé©¶æ–¹å‘</label>
                </div>
                
                <!-- æœç´¢æŒ‰é’®ç»„ -->
                <div class="button-group">
                    <button type="submit" class="search-btn">
                        ğŸ” æœç´¢
                    </button>
                    <a href="/" class="clear-btn">
                        ğŸ—‘ï¸ æ¸…ç©º
                    </a>
                </div>
            </div>
        </form>
        
        <!-- æœç´¢çŠ¶æ€æ˜¾ç¤º -->
        <div class="search-status">
            <span class="status-text" id="search-status-text">
                ğŸ“‹ æ­£åœ¨åŠ è½½æ•°æ®...
            </span>
        </div>
    </div>

    <!-- æ•°æ®å¯è§†åŒ–åŒºåŸŸ -->
    <div class="chart-section">
        <h3>ğŸ“Š æ•°æ®å¯è§†åŒ–</h3>
        
        <!-- æ–¹å‘åˆ†å¸ƒé¥¼å›¾ -->
        <div class="chart-item">
            <h4>ğŸ° æ–¹å‘åˆ†å¸ƒç»Ÿè®¡</h4>
            <div class="chart-container" id="pie-chart-container">
                {{ pie_chart_html|safe }}
            </div>
        </div>
        
        <!-- 24å°æ—¶è¶‹åŠ¿å›¾ -->
        <div class="chart-item">
            <h4>ğŸ“ˆ 24å°æ—¶è½¦æµé‡è¶‹åŠ¿</h4>
            <div class="chart-container chart-wide" id="trend-chart">
                {{ trend_chart_html|safe }}
            </div>
        </div>
        
        <!-- å·¥ä½œæ—¥vså‘¨æœ«å¯¹æ¯”å›¾ -->
        <div class="chart-item">
            <h4>ğŸ“Š å·¥ä½œæ—¥vså‘¨æœ«æµé‡å¯¹æ¯”</h4>
            <div class="chart-container chart-wide" id="weekday-weekend-chart">
                {{ weekday_weekend_chart_html|safe }}
            </div>
        </div>
    </div>

    <!-- äº¤é€šæ•°æ®è¡¨æ ¼ -->
    <div class="table-section">
        <h3>ğŸš— äº¤é€šè®°å½•åˆ—è¡¨</h3>
        
        {% if traffic_records %}
        <table class="traffic-table" id="traffic-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>æ–¹å‘</th>
                    <th>é€šè¿‡æ—¶é—´</th>
                    <th>è½¦ç‰Œå·</th>
                </tr>
            </thead>
            <tbody>
                {% for record in traffic_records %}
                <tr>
                    <td class="center">{{ record.id }}</td>
                    <td class="center direction-{{ record.direction }}">{{ record.direction_text }}</td>
                    <td class="time">{{ record.formatted_time }}</td>
                    <td class="center plate">{{ record.plate }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
        <!-- åˆ†é¡µå¯¼èˆª -->
        <div class="pagination">
            <!-- ä¸Šä¸€é¡µæŒ‰é’® -->
            <button class="page-btn prev-btn disabled" data-page="0">
                â¬…ï¸ ä¸Šä¸€é¡µ
            </button>
            
            <!-- é¡µç æ˜¾ç¤º -->
            <div class="page-numbers">
                <span class="page-num current">1</span>
            </div>
            
            <!-- é¡µç è·³è½¬è¾“å…¥æ¡† -->
            <div class="page-jump">
                <span class="jump-label">è·³è½¬åˆ°</span>
                <input type="number" id="pageInput" class="page-input" min="1" max="1" placeholder="1">
                <button onclick="jumpToPage()" class="jump-btn">GO</button>
            </div>
            
            <!-- ä¸‹ä¸€é¡µæŒ‰é’® -->
            <button class="page-btn next-btn disabled" data-page="0">
                ä¸‹ä¸€é¡µ â¡ï¸
            </button>
        </div>
        
        {% else %}
        <table class="traffic-table" id="traffic-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>æ–¹å‘</th>
                    <th>é€šè¿‡æ—¶é—´</th>
                    <th>è½¦ç‰Œå·</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td colspan="4" style="text-align: center; padding: 40px;">
                        <div style="color: #666;">â³ æ­£åœ¨åŠ è½½æ•°æ®...</div>
                    </td>
                </tr>
            </tbody>
        </table>
        {% endif %}
        
        <!-- åˆ†é¡µå¯¼èˆª (å§‹ç»ˆæ˜¾ç¤ºï¼Œé€šè¿‡AJAXåŠ¨æ€æ›´æ–°) -->
        <div class="pagination" id="pagination-container">
            <!-- ä¸Šä¸€é¡µæŒ‰é’® -->
            <button class="page-btn prev-btn disabled">
                â¬…ï¸ ä¸Šä¸€é¡µ
            </button>
            
            <!-- é¡µç æ˜¾ç¤º -->
            <div class="page-numbers">
                <span class="page-num current">1</span>
            </div>
            
            <!-- é¡µç è·³è½¬è¾“å…¥æ¡† -->
            <div class="page-jump">
                <span class="jump-label">è·³è½¬åˆ°</span>
                <input type="number" id="pageInput" class="page-input" min="1" max="1" placeholder="1">
                <button onclick="jumpToPage()" class="jump-btn">GO</button>
            </div>
            
            <!-- ä¸‹ä¸€é¡µæŒ‰é’® -->
            <button class="page-btn next-btn disabled">
                ä¸‹ä¸€é¡µ â¡ï¸
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/pagination.js') }}"></script>
<script src="{{ url_for('static', filename='js/ajax-search.js') }}"></script>
{% endblock %}
